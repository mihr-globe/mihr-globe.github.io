<!DOCTYPE html>
<html lang="en">

<head>
  <title>mihr</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="demo-styles.css" />
  <script src="font.json"></script>
  <script src="https://unpkg.com/three@0.145.0"></script>
  <script src="https://unpkg.com/three@0.145.0/examples/js/controls/TrackballControls.js"></script>
  <script src="https://unpkg.com/three@0.145.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three@0.145.0/examples/js/loaders/FontLoader.js"></script>
  <script src="https://unpkg.com/three-globe@2.24.13"></script>
</head>

<body>
  <div id="globeViz"></div>
  <div style="position: absolute; top: 10px; left: 10px; z-index: 1;">
    <select id="layer-select">
      <option value="mihr3.png">Default</option>
      <option value="mihr-borders.png">Borders</option>
    </select>
    <select id="locations-select">
      <option value="all">All</option>
      <option value="continents">Continents</option>
      <option value="nations">Nations</option>
      <option value="cities">Cities</option>
      <option value="geography">Geography</option>
    </select>
  </div>
  <script type="module">
    const loader = new THREE.FontLoader();
    const font = await loader.loadAsync('font.json');
    const geoData = await fetch('https://raw.githubusercontent.com/mihr-globe/mihr-globe.github.io/refs/heads/main/labels.json').then(res => res.json());
    let layer = 'mihr3.png';
    let locationsLayer = 'all';
    let globe = setupGlobe('https://raw.githubusercontent.com/mihr-globe/mihr-globe.github.io/refs/heads/main/mihr3.png', "all")

    // Setup renderer
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('globeViz').appendChild(renderer.domElement);

    // Setup scene
    const scene = new THREE.Scene();
    scene.add(globe);
    scene.add(new THREE.AmbientLight(0xbbbbbb));
    scene.add(new THREE.DirectionalLight(0xffffff, 0.6));

    // Setup camera
    const camera = new THREE.PerspectiveCamera();
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    camera.position.z = 500;

    // Add camera controls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.minDistance = 101;

    function animate() {
      controls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    };

    animate();

    function setupGlobe(globeImageUrl, locations) {
      let labels = [];
      switch (locations) {
        case "all":
          labels = [...geoData.continents, ...geoData.nations, ...geoData.cities, ...geoData.geography];
          break;
        case "continents":
          labels = geoData.continents;
          break;
        case "nations":
          labels = geoData.nations;
          break;
        case "cities":
          labels = geoData.cities;
          break;
        case "geography":
          labels = geoData.geography;
          break;
      }
      return new ThreeGlobe()
        .globeImageUrl(globeImageUrl)
        .showAtmosphere(false)
        .showGraticules(true)
        .labelsData(labels)
        .labelResolution([5])
        .labelText('text')
        .labelRotation('rotation')
        .labelSize('size')
        .labelDotRadius('dotradius')
        .labelColor('color')
        .labelTypeFace(font.data);
    }

    const layerSelect = document.getElementById('layer-select');
    const locationsSelect = document.getElementById('locations-select');

    layerSelect.addEventListener('change', (event) => {
      layer = event.target.value;
      scene.remove(globe);
      globe = setupGlobe('https://raw.githubusercontent.com/mihr-globe/mihr-globe.github.io/refs/heads/main/' + layer, locationsLayer);
      scene.add(globe);
    });

    locationsSelect.addEventListener('change', (event) => {
      locationsLayer = event.target.value;
      scene.remove(globe);
      globe = setupGlobe('https://raw.githubusercontent.com/mihr-globe/mihr-globe.github.io/refs/heads/main/' + layer, locationsLayer);
      scene.add(globe);
    });
  </script>
</body>
</html>
